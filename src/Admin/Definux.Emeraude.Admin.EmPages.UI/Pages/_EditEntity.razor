@page "/admin/{entityKey}/{entityId}/edit"
@inherits EmPage
@using Definux.Emeraude.Admin.UI.Extensions
@if (ViewSchema != null)
{
    <EmPageFormView ViewSchema="ViewSchema" ViewData="ViewData" />
}

@code {
    private EmPageFormViewSchema ViewSchema { get; set; }
    
    private EmPageFormViewData ViewData { get; set; }
    
    [Parameter]
    public string EntityId { get; set; }

    protected override IEnumerable<BreadcrumbItemModel> ConfigureBreadcrumbs()
        => ViewSchema?.Breadcrumbs ?? new List<BreadcrumbItemModel>();

    protected override IEnumerable<ActionModel> ConfigureNavigationActions()
        => ViewSchema?.NavbarActions ?? new List<ActionModel>();
    
    protected override async Task ReloadPageAsync()
    {
        ViewSchema = await SchemaProvider.GetFormViewSchemaAsync(EmPageFormType.EditForm, EntityKey);
        StateHasChanged();
        if (ViewSchema == null)
        {
            NavigationManager.NavigateToNotFoundPage();
            return;
        }
        
        ViewData = await DataProvider.RetrieveFormViewDataAsync(EmPageFormType.EditForm, EntityKey, EntityId, GetQueryParameters(), ViewSchema);
        StateHasChanged();
    }

}