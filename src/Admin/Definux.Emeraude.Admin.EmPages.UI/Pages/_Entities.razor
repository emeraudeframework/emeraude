@page "/admin/{route}"
@inherits EmPage

<PageTitle>@PageTitle | Emeraude</PageTitle>
<EmPageTableView ViewSchema="ViewSchema" ViewData="ViewData" />

@code {
    private EmPageTableViewSchema ViewSchema { get; set; }
    
    private EmPageTableViewData ViewData { get; set; }
    
    private string PageTitle => ViewSchema?.Context.Title;

    protected override IEnumerable<BreadcrumbItemModel> ConfigureBreadcrumbs()
        => ViewSchema?.Context.Breadcrumbs ?? new List<BreadcrumbItemModel>();

    protected override IEnumerable<ActionModel> ConfigureNavigationActions()
        => ViewSchema?.Context.NavbarActions ?? new List<ActionModel>();

    private void ResetData()
    {
        ViewSchema = null;
        ViewData = null;
        StateHasChanged();
    }

    protected override async Task ReloadPageAsync()
    {
        ResetData();
        ViewSchema = await SchemaProvider.GetTableViewSchemaAsync(Route);
        if (ViewSchema == null)
        {
            NavigationManager.NavigateToNotFoundPage();
            return;
        }
        
        ViewData = await DataService.RetrieveTableViewDataAsync(Route, GetQueryParameters(), ViewSchema);
        StateHasChanged();
    }

}