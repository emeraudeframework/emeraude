@page "/admin/{route}/create"
@inherits EmPage

<PageTitle>@PageTitle | Emeraude</PageTitle>
<EmPageFormView ViewModel="ViewModel" />

@code {
    private EmPageFormViewModel ViewModel { get; set; }

    private string PageTitle => ViewModel?.Context.Title;

    protected override IEnumerable<BreadcrumbItemModel> ConfigureBreadcrumbs()
        => ViewModel?.Context.Breadcrumbs ?? new List<BreadcrumbItemModel>();

    protected override IEnumerable<ActionModel> ConfigureNavigationActions()
        => ViewModel?.Context.NavbarActions ?? new List<ActionModel>();
    
    private void ResetData()
    {
        ViewModel = null;
        StateHasChanged();
    }
    
    protected override async Task ReloadPageAsync()
    {
        ResetData();
        var viewModel = await EmPageManager.RetrieveFormViewModelAsync(EmPageFormType.CreateForm, Route, null, GetQueryParameters());
        if (viewModel == null)
        {
            NavigationManager.NavigateToNotFoundPage();
            return;
        }

        ViewModel = viewModel;
        StateHasChanged();
    }

}